@page
@model UPCI.Portal.Pages.Membership.IndexModel
@{
    ViewData["Title"] = Model.PageTitle;
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

@* @using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor *@
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
<div id="MembersController">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1><button type="button" class="btn btn-md" onclick="GoBack();"><i class="nav-icon fa fa-lg fa-arrow-circle-left text-info"></i></button> <b>@ViewData["Title"]</b> </h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        @foreach (var item in Model.PageUrl.Split('/'))
                        {
                            if (!String.IsNullOrEmpty(@item))
                            {
                                <li class="breadcrumb-item">@item</li>
                            }
                        }
                    </ol>
                </div>
            </div>
        </div>
    </section>
    <section class="content">
        <div class="container-fluid" autocomplete="off">
            <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-6  input-group mb-3">
                    @if (Model.Actions.Contains("ACN04"))
                    {
                        <input type="text" id="searchCode" autocomplete="off" class="form-control" placeholder="Member ID" v-model="search.code" v-on:keypress="KeyPress_Search" data-parsley-restrict-special-characters />
                    }
                    <div class="input-group-prepend">
                        @if (Model.Actions.Contains("ACN04"))
                        {
                            <button type="button" class="btn btn-default btn-sm" v-on:click="Search();">
                                <i class="nav-icon fas fa-search"></i> Search
                            </button>
                        }
                        @if (Model.Actions.Contains("ACN06"))
                        {
                            <button type="button" class="btn btn-default btn-sm" data-toggle="modal" v-on:click="Filter()" data-target="#filterModal">
                                <i class="nav-icon fas fa-filter"></i> Advance Filter
                            </button>
                        }
                        @if (Model.Actions.Contains("ACN01"))
                        {
                            <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#formModal" v-on:click="Add();">
                                <i class="nav-icon fas fa-plus-circle"></i> Add
                            </button>
                        }
                    </div>
                </div>
            </div> 
            <div class="row">
                <div class="col-12 table-responsive" v-show="!datatable.show_table">
                    <span class="text-danger">No record(s) found!</span>
                </div>
                <div class="col-12 table-responsive" v-show="datatable.show_table">
                    <div class="row form-group">
                        &nbsp;
                        &nbsp;
                        Show
                        &nbsp;
                        <select name="datatable_length" v-model="datatable.pageSize" class="custom-select-sm" v-on:change="itemCountChange()" style="height: auto;line-height: 12px;">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        &nbsp;
                        records
                    </div>
                    <table class="table table-striped table-hover text-sm" >
                        <thead class="bg-secondary">
                            <tr>
                                <th width="5%"> Active <i :class="['fas', SortClass('ActiveMember')]" style="cursor:pointer" v-on:click="Sort('ActiveMember')"></i></th>
                                <th width="15%">Code <i :class="['fas', SortClass('Code')]" style="cursor:pointer" v-on:click="Sort('Code')"></i></th>
                                <th width="15%">Name <i :class="['fas', SortClass('LastName,FirstName')]" style="cursor:pointer" v-on:click="Sort('LastName,FirstName')"></i></th>
                                <th width="20%">Personal Info</th>
                                <th width="20%">Church Info</th>
                                <th width="15%">Groups</th> 
                                <th class="text-center" width="10%">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in items" :key="item.encryptedId">
                                <td class="text-center align-middle"> 
                                    <div class="text-center">
                                        <!-- Image with Border -->
                                        <img id="profileImg"
                                             :src="item.imageDataString || '/Assets/Images/default-user.jpg'"
                                            
                                             class="img-circle elevation-2 border"
                                             alt="Profile Image"
                                             style="cursor:pointer; height:50px; width:50px;">

                                        <!-- Status Badges -->
                                        <div class="mt-2">
                                            <span class="badge badge-pill badge-success" v-if="item.activeMember">Active</span>
                                            <span class="badge badge-pill badge-danger" v-else>Inactive</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="align-middle" data-title="Code">{{item.code}}</td>
                                <td class="align-middle" data-title="Name">
                                    {{item.firstName}}   <br />
                                    <template v-if="item.middleName != ''">{{item.middleName}} <br /></template>
                                    {{item.lastName}}
                                </td>
                                <td class="align-middle" data-title="Personal Info">
                                    <div v-if="item.gender == 'M'">
                                        <i class="fa-solid fa-mars text-primary"></i>&nbsp;&nbsp;Male
                                    </div>
                                    <div v-if="item.gender == 'F'">
                                        <i class="fa-solid fa-venus text-danger"></i>&nbsp;&nbsp;Female
                                    </div>
                                    <div v-if="item.gender == ''">
                                        <i class="fa-solid fa-venus-mars text-warning"></i>&nbsp;&nbsp;Not Specified
                                    </div>
                                    <div v-if="item.birthday != ''">
                                        <i class="fas fa-birthday-cake text-success"></i>&nbsp;&nbsp;{{FormatDateBirthday(item.birthday)}}
                                    </div>
                                    <div v-if="item.civilStatus != ''">
                                        <i class="fas fa-heart text-danger"></i>&nbsp;&nbsp;{{item.civilStatusDesc}}
                                    </div> 
                                    <div v-if="item.email != ''">
                                        <i class="fas fa-paper-plane text-info"></i>&nbsp;&nbsp;{{item.email}}
                                    </div>
                                    <div v-if="item.contactNo != ''">
                                        <i class="fas fa-mobile-alt text-info"></i>&nbsp;&nbsp;{{item.contactNo}}
                                    </div>
                                    <div v-if="item.address != ''">
                                        <i class="fas fa-home text-warning"></i> {{item.address}}
                                    </div>
                                </td>
                                <td class="align-middle" data-title="Church Info">
                                    <div v-if="item.memberType != ''">
                                        <b>Member Type:</b>  {{item.memberTypeDesc}}
                                    </div>
                                    <div>
                                        <b>Baptized:</b> 
                                        <template v-if="item.baptized">
                                            <span class="text-success"><i class="fas fa-check"></i> Yes</span>
                                        </template>
                                        <template v-else>
                                            <span class="text-danger"><i class="fas fa-x"></i> No</span>
                                        </template>
                                    </div>
                                    <div>
                                        <b>Involved to Cell:</b>  
                                        <template v-if="item.memberMinistry.length > 0">
                                            <span class="text-success"><i class="fas fa-check"></i> Yes</span>
                                        </template>
                                        <template v-else>
                                            <span class="text-danger"><i class="fas fa-x"></i> No</span>
                                        </template>
                                    </div>
                                    <div>
                                        <b>Involved to Ministry:</b>
                                        <template v-if="item.memberCell.length > 0">
                                            <span class="text-success"><i class="fas fa-check"></i> Yes</span>
                                        </template>
                                        <template v-else>
                                            <span class="text-danger"><i class="fas fa-x"></i> No</span>
                                        </template>
                                    </div>
                                    <div v-if="item.pepsol != ''">
                                        <b>PEPSOL:</b>  {{item.pepsolDesc}}
                                    </div>
                                    <div v-if="item.firstAttend != ''">
                                        <b>First Attend:</b> {{FormatDate(item.firstAttend)}}
                                    </div>
                                    <div v-if="item.baptismDate != ''">
                                        <b>Baptism Date:</b> {{FormatDate(item.baptismDate)}}
                                    </div>
                                </td>
                                <td class="align-middle" data-title="Groups">
                                    <div>
                                        <b>Cell Groups:</b> <br />
                                        <span v-for="(cell, index) in item.memberCell" :key="index">
                                            {{cell.cellDesc}}  
                                            <span v-if="index < item.memberCell.length - 1" class="text-success text-bold"> | </span>
                                        </span>
                                        <span v-if="item.memberCell.length == 0">
                                            <span class="text-danger">None</span>
                                        </span>
                                    </div>
                                    <br />
                                    <div>
                                        <b>Ministries:</b> <br />
                                        <span v-for="(ministry, index) in item.memberMinistry" :key="index">
                                            {{ministry.ministryDesc}}
                                            <span v-if="index < item.memberMinistry.length - 1" class="text-success text-bold"> | </span>
                                        </span>
                                        <span v-if="item.memberMinistry.length == 0">
                                            <span class="text-danger">None</span>
                                        </span>
                                    </div>
                                </td>
                                <td class="text-center align-middle">
                                    
                                    @if (Model.Actions.Contains("ACN05"))
                                    {
                                        <button type="button" class="btn btn-info btn-sm mr-1" data-toggle="modal" data-target="#ViewModal" v-on:click="View(item)" data-tooltip="tooltip" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    }
                                    @if (Model.Actions.Contains("ACN02"))
                                    {
                                        <button type="button" class="btn btn-success btn-sm mr-1" data-toggle="modal" data-target="#formModal" v-on:click="Edit(item)" data-tooltip="tooltip" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    }

                                    @if (Model.Actions.Contains("ACN03"))
                                    {
                                        <button type="button" class="btn btn-danger btn-sm mr-1" v-on:click="Delete(item);" data-tooltip="tooltip" title="Delete">
                                            <i class="far fa-trash-alt"></i>
                                        </button>
                                    }
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-12 table-responsive" ng-show="show_table">
                    <ul id="sync-pagination" class="pagination-sm float-right"></ul>
                </div>
            </div>
            <div id="filterModal" class="modal fade text-sm" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-md" role="document">
                    <form name="filterModal" id="formFilter" method="post" autocomplete="off" data-parsley-validate>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title left"><i class="nav-icon fas fa-search-plus"></i> Advance Search</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">×</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row col">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="MemberId">Member ID</label>
                                            <input type="text" id="searchCode" autocomplete="off" class="form-control" placeholder="Member ID" 
                                                v-model="search.code" 
                                                v-on:keypress="KeyPress_Search" 
                                                data-parsley-restrict-special-characters />
                                        </div>
                                    </div>
                                </div>
                                <div class="row col">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="DateTo">Fullname</label>
                                            <input type="text" class="form-control" 
                                                   v-model="search.fullname"
                                                   id="searchFullname"
                                                   data-parsley-id="fullname"
                                                   data-parsley-trigger="change focusout"
                                                   data-parsley-restrict-special-characters>
                                        </div>
                                    </div> 
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Gender</label>
                                            <select class="custom-select"  
                                                    v-model="search.gender"
                                                    id="searchGender">
                                                <option value="" selected>All</option>
                                                <option value="M">Male</option>
                                                <option value="F">Female</option>
                                            </select> 
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Civil Status</label>
                                            <select class="custom-select" 
                                                    id="searchCivilStatus"
                                                    v-model="search.civilStatus">
                                                <option value="" selected>All</option>
                                                <option value="SNG">Single</option>
                                                <option value="MAR">Married</option>
                                                <option value="SEP">Separated</option>
                                                <option value="WDW">Widow</option>
                                                <option value="WDR">Widower</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="DateTo">Address</label>
                                            <input type="text" class="form-control" 
                                                   v-model="search.address"
                                                   id="searchAddress"
                                                   data-parsley-id="address"
                                                   data-parsley-trigger="change focusout"
                                                   data-parsley-address>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal"><i class="nav-icon fas fa-times-circle"></i> Close</button>
                                <button type="button" class="btn btn-success btn-sm" v-on:click="ApplyFilter()"><i class="nav-icon fas fa-check-circle"></i> Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            @if (Model.Actions.Contains("ACN01") || Model.Actions.Contains("ACN02"))
            {
                <div id="formModal" class="modal fade text-sm" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-dialog-scrollable align-items-center justify-content-center" style="min-width:90%" role="document">
                        <form name="formModal" id="form" method="post" style="min-width:90%" autocomplete="off" data-parsley-validate>
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title left"> <i :class="['fa',ActionModeIcon()]"> </i>   {{ actionMode }} @ViewData["Title"]</h5>
                                    <a href="#" class="modal-close right"><i class="mdl2 mdl2-cancel" aria-hidden="true"></i></a>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-12 col-md-12 col-lg-5">
                                            <div class="card card-success card-outline">
                                                <div class="card-header">
                                                    <h3 class="card-title"><i class="nav-icon fas fa-user"></i> Personal Details</h3>
                                                    <div class="card-tools">
                                                        <button type="button" class="btn btn-tool" data-card-widget="collapse" >
                                                            <i class="fas fa-minus"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="card-body" > 
                                                    <div class="row">
                                                        <div class="col-md-12 pb-4 text-center">
                                                            <div class="mt-3">
                                                                <img id="profileImg" data-toggle="modal" data-target="#memberProfileModal" v-on:click="ChangeMemberProfileImage()" :src="imageData || '/Assets/Images/default-user.jpg'" class="img-circle elevation-2" alt="Profile Image" style="cursor:pointer; height:150px; width:150px;">
                                                            </div> 
                                                        </div>
                                                         
                                                        <div class="col-sm-12 col-md-12 col-lg-12 col-xl-4">
                                                            <div class="form-group">
                                                                <label for="code">First Name</label>
                                                                <input type="text" class="form-control" name="firstname"
                                                                    v-model="formData.firstName" 
                                                                       data-parsley-id="firstname"
                                                                       data-parsley-required-field
                                                                       data-parsley-validate-if-empty
                                                                       data-parsley-trigger="change focusout"
                                                                       data-parsley-restrict-special-characters>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-12 col-lg-12 col-xl-4">
                                                            <div class="form-group">
                                                                <label for="code">Middle Name</label>
                                                                <input type="text" class="form-control" name="middleName" placeholder="(optional)"
                                                                       v-model="formData.middleName"
                                                                       data-parsley-id="middleName" 
                                                                       data-parsley-validate-if-empty
                                                                       data-parsley-trigger="change focusout"
                                                                       data-parsley-restrict-special-characters>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-12 col-lg-12 col-xl-4">
                                                            <div class="form-group">
                                                                <label for="code">Last Name</label>
                                                                <input type="text" class="form-control" name="lastName"
                                                                       v-model="formData.lastName"
                                                                       data-parsley-id="lastName"
                                                                       data-parsley-required-field
                                                                       data-parsley-validate-if-empty
                                                                       data-parsley-trigger="change focusout"
                                                                       data-parsley-restrict-special-characters>
                                                            </div>
                                                        </div>
                                                    </div>
                                                
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
                                                            <div class="form-group">
                                                                <label for="code">Birthday</label>
                                                                <input type="text" class="form-control datetimepicker-input" id="dateBday" name="birthday"
                                                                       v-model="formData.birthday"
                                                                       data-parsley-id="lastName"
                                                                       data-parsley-required-field
                                                                       data-parsley-validate-if-empty
                                                                       data-parsley-trigger="change focusout"
                                                                       data-parsley-date-format>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
                                                            <div class="form-group">
                                                                <label>Gender</label>
                                                                <select class="custom-select" id="gender"
                                                                        v-model="formData.gender"
                                                                        data-parsley-trigger="change focusout"
                                                                        data-parsley-required-message="Required field"
                                                                        required>
                                                                    <option value="" selected>-- Please Select --</option>
                                                                    <option value="M">Male</option>
                                                                    <option value="F">Female</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
                                                            <div class="form-group">
                                                                <label>Civil Status</label>
                                                                <select class="custom-select" id="civilStatus"
                                                                        v-model="formData.civilStatus"
                                                                        data-parsley-trigger="change focusout"
                                                                        data-parsley-required-message="Required field"
                                                                        required>
                                                                    <option value="" selected>-- Please Select --</option>
                                                                    <option value="SNG">Single</option>
                                                                    <option value="MAR">Married</option>
                                                                    <option value="SEP">Separated</option>
                                                                    <option value="WDW">Widow</option>
                                                                    <option value="WDR">Widower</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-12 col-lg-8 col-xl-8">
                                                            <div class="form-group">
                                                                <label for="code">Email</label>
                                                                <input type="text" class="form-control" name="email" placeholder="(optional)"
                                                                       v-model="formData.email">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
                                                            <div class="form-group">
                                                                <label for="code">Contact #</label>
                                                                <input type="text" class="form-control" name="contact" placeholder="(optional)"
                                                                       v-model="formData.contactNo">
                                                            </div>
                                                        </div>
                                                       
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <div class="form-group">
                                                                <label for="code">Address</label>
                                                                <input type="text" class="form-control" name="address" placeholder="(optional)"
                                                                       v-model="formData.address">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                            </div>
                                            
                                        </div>
                                        <div class="col-12 col-md-12 col-lg-7">
                                            <div class="card card-primary card-outline">
                                                <div class="card-header card-outline">
                                                    <h3 class="card-title"><i class="nav-icon fas fa-church"></i> Church Information</h3>
                                                    <div class="card-tools">
                                                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                            <i class="fas fa-minus"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                            <div class="form-group">
                                                                <label for="code">Member Type</label>
                                                                <select class="custom-select" id="memberType"
                                                                        v-model="formData.memberType"
                                                                        data-parsley-trigger="change focusout"
                                                                        data-parsley-required-message="Required field"
                                                                        required>
                                                                    <option value="NEW">New Comer</option>
                                                                    <option value="MEMBER">Member</option>
                                                                    <option value="WORKER">Worker</option>
                                                                    <option value="LEADER">Leader</option>
                                                                    <option value="PASTOR">Pastor</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                            <div class="form-group">
                                                                <label for="code">PEPSOL Level</label>
                                                                <select class="custom-select" id="civilStatus"
                                                                        v-model="formData.pepsol">
                                                                    <option value="" selected>Not Involved</option>
                                                                    <option value="CONSO">Consolidation</option>
                                                                    <option value="LIFE">Life Class</option>
                                                                    <option value="SOL1">SOL1</option>
                                                                    <option value="SOL2">SOL2</option>
                                                                    <option value="SOL3">SOL3</option>
                                                                    <option value="GRAD">Graduate</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                            <div class="form-group">
                                                                <label for="code">Date of First Attend</label>
                                                                <input type="text" id="dateFirstAttend" class="form-control" name="datefirstAttend" placeholder="(optional)"
                                                                       v-model="formData.firstAttend">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                            <div class="form-group">
                                                                <label for="code">Date of Baptism</label>
                                                                <input type="text" id="dateBaptized" class="form-control" name="dateBaptized" placeholder="(optional)"
                                                                       v-model="formData.baptismDate">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                            <div class="form-group">
                                                                <label for="code">Is an <b class="text-danger">Active</b> member?</label>
                                                                <div class="form-check">
                                                                    <label class="form-check-label">
                                                                        <input type="radio" value="false" v-model="formData.activeMember" name="rdbActive">
                                                                        No
                                                                    </label>
                                                                    &nbsp;&nbsp;&nbsp;
                                                                    <label class="form-check-label">
                                                                        <input type="radio" value="true" v-model="formData.activeMember" name="rdbActive">
                                                                        Yes
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                            <div class="form-group">
                                                                <label for="code">Already <b class="text-danger">Baptized</b> by a Pastor?</label>
                                                                <div class="form-check">
                                                                    <label class="form-check-label">
                                                                        <input type="radio" value="false" v-model="formData.baptized" name="rdbBaptized">
                                                                        No
                                                                    </label>
                                                                    &nbsp;&nbsp;&nbsp;
                                                                    <label class="form-check-label">
                                                                        <input type="radio" value="true" v-model="formData.baptized" name="rdbBaptized">
                                                                        Yes
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div> 
                                                    </div>
                                                    

                                                </div>
                                            </div>
                                            <div class="card card-info card-outline">
                                                <div class="card-header card-outline">
                                                    <h3 class="card-title"><i class="nav-icon fas fa-users"></i> Cell Groups</h3>
                                                    <div class="card-tools">
                                                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                            <i class="fas fa-minus"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                      
                                                        <div class="col-12 table-responsive">

                                                            <table class="table table-striped text-sm">
                                                                <thead>
                                                                     
                                                                </thead>
                                                                <tbody>
                                                                    <tr v-for="selectedCell in selectedCells" :key="selectedCell.id">
                                                                        <td width="40%" class="align-middle"> {{selectedCell.cellDesc}}</td>
                                                                        <td width="40%" class="align-middle"> {{selectedCell.positionCellDesc}}</td>
                                                                        <td width="20%" class="text-right align-middle">

                                                                            <button type="button" class="btn btn-success btn-xs mr-1" data-toggle="modal" data-target="#cellFormModal" v-on:click="EditCell(selectedCell)" title="Edit">
                                                                                <i class="fas fa-edit"></i>
                                                                            </button>


                                                                            <button type="button" class="btn btn-danger btn-xs mr-1" v-on:click="RemoveCell(selectedCell)" title="Remove">
                                                                                <i class="far fa-trash-alt"></i>
                                                                            </button>
                                                                            
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div> 
                                                    </div>
                                                    <div class="col float-right">
                                                        <button type="button" class="btn btn-primary btn-sm float-right" data-toggle="modal" data-target="#cellFormModal" v-on:click="AddCell()">  <i class="nav-icon fas fa-plus"></i> Add Cell</button>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class="card card-warning card-outline">
                                                <div class="card-header card-outline">
                                                    <h3 class="card-title"><i class="nav-icon fas fa-music"></i> Ministries</h3>
                                                    <div class="card-tools">
                                                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                            <i class="fas fa-minus"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                      
                                                        <div class="col-12 table-responsive"> 
                                                            <table class="table table-striped text-sm">
                                                                <thead>
                                                                </thead>
                                                                <tbody>
                                                                    <tr v-for="selectedMinistry in selectedMinistries" :key="selectedMinistry.id">
                                                                        <td width="30%" class="align-middle"> {{selectedMinistry.departmentDesc}}</td>
                                                                        <td width="30%" class="align-middle"> {{selectedMinistry.ministryDesc}}</td>
                                                                        <td width="20%" class="align-middle"> {{selectedMinistry.positionMinistryDesc}}</td>
                                                                        <td width="20%" class="text-right align-middle">

                                                                            <button type="button" class="btn btn-success btn-xs mr-1" data-toggle="modal" data-target="#ministryFormModal" v-on:click="EditMinistry(selectedMinistry)" title="Edit">
                                                                                <i class="fas fa-edit"></i>
                                                                            </button>
                                                                            <button type="button" class="btn btn-danger btn-xs mr-1" v-on:click="RemoveMinistry(selectedMinistry)" title="Remove">
                                                                                <i class="far fa-trash-alt"></i>
                                                                            </button>
                                                                             
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div> 
                                                    </div>
                                                    <div class="col float-right">
                                                        <button type="button" class="btn btn-primary btn-sm float-right" data-toggle="modal" data-target="#ministryFormModal" v-on:click="AddMinistry()"><i class="nav-icon fas fa-plus"></i> Add Ministry</button>
                                                    </div>
                                                </div>
                                               
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer justify-content-between">
                                    <button type="button" class="btn btn-default btn-sm" data-dismiss="modal"><i class="nav-icon fas fa-times-circle"></i> Close</button>
                                    <button type="button" class="btn btn-success btn-sm" :disabled="isFormValid.value" v-on:click="Save()"><i class="nav-icon fas fa-check-circle"></i> Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            }
            <div id="cellFormModal" class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-md" role="document">
                    <form name="cellFormModal" id="cellForm" method="post" autocomplete="off" data-parsley-validate>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title left"> Cell</h5>
                                <a href="#" class="modal-close right"><i class="mdl2 mdl2-cancel" aria-hidden="true"></i></a>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Cell</label>
                                            <select class="custom-select"
                                                    v-model="formDataGroups.cell"
                                                    :disabled="disableControl.selectedCell"
                                                    data-parsley-trigger="change focusout"
                                                    data-parsley-required-message="Required field"
                                                    required>
                                                <option value="">-- Please Select --</option>
                                                <template v-for="cell in cells" :key="cell.id">
                                                    <option :value="cell.code">{{cell.description}} </option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Position</label>
                                            <select class="custom-select" id="cellPosition"
                                                    v-model="formDataGroups.positionCell"
                                                    data-parsley-trigger="change focusout"
                                                    data-parsley-required-message="Required field"
                                                    required>
                                                <option value="">-- Please Select --</option> 
                                                <template v-for="positionCell in positionCells" :key="positionCell.id">
                                                    <option :value="positionCell.code">{{positionCell.description}} </option>
                                                </template> 
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal"><i class="nav-icon fas fa-times-circle"></i> Close</button>
                                <button type="button" class="btn btn-success btn-sm" v-on:click="SaveCell()"><i class="nav-icon fas fa-check-circle"></i> Save Cell</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div id="ministryFormModal" class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-md" role="document">
                    <form name="ministryFormModal" id="ministryForm" method="post" autocomplete="off" data-parsley-validate>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title left"> Ministry</h5>
                                <a href="#" class="modal-close right"><i class="mdl2 mdl2-cancel" aria-hidden="true"></i></a>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Department</label>
                                            <select class="custom-select"
                                                    v-model="formDataGroups.departmentCode"
                                                    v-on:change="DepartmentChange(formDataGroups.departmentCode)"
                                                    :disabled="disableControl.selectedDepartment"
                                                    data-parsley-trigger="change focusout"
                                                    data-parsley-required-message="Required field"
                                                    required>
                                                <option value="">-- Please Select --</option>
                                                <template v-for="department in departments" :key="department.id">
                                                    <option :value="department.code">{{department.description}} </option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Ministry</label>
                                            <select class="custom-select"
                                                    v-model="formDataGroups.ministry"
                                                    :disabled="disableControl.selectedMinistry"
                                                    data-parsley-trigger="change focusout"
                                                    data-parsley-required-message="Required field"
                                                    required>
                                                <option value="">-- Please Select --</option>
                                                <template v-for="ministry in ministries" :key="ministry.id">
                                                    <option :value="ministry.code">{{ministry.description}} </option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label>Position</label>
                                            <select class="custom-select" id="ministryPosition"
                                                    v-model="formDataGroups.positionMinistry"
                                                    data-parsley-trigger="change focusout"
                                                    data-parsley-required-message="Required field"
                                                    required>
                                                <option value="">-- Please Select --</option>
                                                <template v-for="positionMinistry in positionMinistries" :key="positionMinistry.id">
                                                    <option :value="positionMinistry.code">{{positionMinistry.description}} </option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal"><i class="nav-icon fas fa-times-circle"></i> Close</button>
                                <button type="button" class="btn btn-success btn-sm" v-on:click="SaveMinistry()"><i class="nav-icon fas fa-check-circle"></i> Save Ministry</button>
                            </div>
                        </div> 
                    </form>
                </div>
            </div>
            @if (Model.Actions.Contains("ACN05"))
            {
                <div id="ViewModal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-xls" role="document"> 
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title left"> View Member</h5>
                                <a href="#" class="modal-close right"><i class="mdl2 mdl2-cancel" aria-hidden="true"></i></a>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-6 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="d-flex flex-column align-items-center text-center">
                                                    <img :src="imageData || '/Assets/Images/default-user.jpg'" class="img-fluid rounded" width="150">
                                                    <div class="mt-3">
                                                        <h5>{{viewData.fullName}}</h5>
                                                        <h4 class="text-success mb-1">{{viewData.memberTypeDesc}}</h4> 
                                                    </div> 
                                                </div>
                                                <hr />
                                                <div class="row">
                                                    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 text-center">
                                                        <div class="mb-0">
                                                            <h6 for="code">Baptized</h6>
                                                            <template v-if="viewData.baptized">
                                                                <p class="text-success">Yes</p>
                                                            </template>
                                                            <template v-else>
                                                                <p class="text-danger">No</p>
                                                            </template>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 text-center">
                                                        <div class="mb-0">
                                                            <h6 for="code">Involved To Cell</h6>
                                                            <template v-if="selectedCells.length > 0">
                                                                <p class="text-success">Yes</p>
                                                            </template>
                                                            <template v-else>
                                                                <p class="text-danger">No</p>
                                                            </template>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 text-center">
                                                        <div class="mb-0">
                                                            <h6 for="code">Involved To Ministry</h6>
                                                            <template v-if="selectedMinistries.length > 0">
                                                                <p class="text-success">Yes</p>
                                                            </template>
                                                            <template v-else>
                                                                <p class="text-danger">No</p>
                                                            </template>
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr />
                                                <div class="row">
                                                    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 text-center">
                                                        <div class="mb-0">
                                                            <h6 for="code">PEPSOL</h6>
                                                            {{viewData.pepsolDesc}}
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 text-center">
                                                        <div class="mb-0">
                                                            <h6 for="code">First Attend</h6>
                                                            {{FormatDate(viewData.firstAttend)}}
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4 text-center">
                                                        <div class="mb-0">
                                                            <h6 for="code">Baptism Date</h6>
                                                            {{FormatDate(viewData.baptismDate)}}
                                                        </div>
                                                    </div>

                                                  @*   <div class="col-sm-5">
                                                        <h7 class="mb-0">First Attend Date</h7>
                                                    </div>
                                                    <div class="col-sm-7 text-secondary">
                                                       
                                                    </div> *@
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-12 col-lg-6 mb-3">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Name</h6>
                                                    </div>
                                                    <div class="col-sm-9 text-secondary">
                                                        {{viewData.fullName}}
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Birthday</h6>
                                                    </div>
                                                    <div class="col-sm-9 text-secondary">
                                                        {{FormatDateBirthday(viewData.birthday)}}
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Email</h6>
                                                    </div>
                                                    <div class="col-sm-9 text-secondary">
                                                        {{viewData.email}}
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Contact</h6>
                                                    </div>
                                                    <div class="col-sm-9 text-secondary">
                                                        {{viewData.contactNo}}
                                                    </div>
                                                </div>
                                                <hr> 
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Address</h6>
                                                    </div>
                                                    <div class="col-sm-9 text-secondary">
                                                        {{viewData.address}}
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Civil Status</h6>
                                                    </div>
                                                    <div class="col-sm-9 text-secondary">
                                                        {{viewData.civilStatusDesc}}
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h6 class="mb-0">Gender</h6>
                                                    </div> 
                                                    <div class="col-sm-9 text-secondary" v-if="viewData.gender == 'M'">
                                                        <i class="fa-solid fa-mars text-primary"></i>&nbsp;&nbsp;Male
                                                    </div>
                                                    <div class="col-sm-9 text-secondary" v-if="viewData.gender == 'F'">
                                                        <i class="fa-solid fa-venus text-danger"></i>&nbsp;&nbsp;Female
                                                    </div>
                                                    <div class="col-sm-9 text-secondary" v-if="viewData.gender == ''">
                                                        <i class="fa-solid fa-venus-mars text-warning"></i>&nbsp;&nbsp;Not Specified
                                                    </div>
                                                </div>
                                                <hr>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
                                        <div class="card card-info card-outline"> 
                                            <div class="card-header card-outline">
                                                <h3 class="card-title"><i class="nav-icon fas fa-users"></i> Cell Groups</h3>
                                                <div class="card-tools">
                                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="row"> 
                                                    <div class="col-12 table-responsive">
                                                        <table class="table text-sm">
                                                            <thead>
                                                            </thead>
                                                            <tbody>
                                                                <tr v-for="selectedCell in selectedCells" :key="selectedCell.id"> 
                                                                    <td width="50%" class="align-middle"> {{selectedCell.cellDesc}}</td>
                                                                    <td width="50%" class="align-middle"> {{selectedCell.positionCellDesc}}</td> 
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
                                        <div class="card card-warning card-outline">
                                            
                                            <div class="card-header card-outline">
                                                <h3 class="card-title"><i class="nav-icon fas fa-music"></i> Ministries</h3>
                                                <div class="card-tools">
                                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-12 table-responsive">
                                                        <table class="table text-sm">
                                                            <thead>
                                                            </thead>
                                                            <tbody>
                                                                <tr v-for="selectedMinistry in selectedMinistries" :key="selectedMinistry.id">
                                                                    <td width="30%" class="align-middle"> {{selectedMinistry.departmentDesc}}</td>
                                                                    <td width="30%" class="align-middle"> {{selectedMinistry.ministryDesc}}</td>
                                                                    <td width="20%" class="align-middle"> {{selectedMinistry.positionMinistryDesc}}</td>
                                                                        
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div> 
                                            </div>
                                                 
                                        </div>
                                    </div> 
                                </div> 
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal"><i class="nav-icon fas fa-times-circle"></i> Close</button> 
                            </div>
                        </div> 
                    </div>
                </div>
            }
        </div>
    </section>
    <div id="memberProfileModal" class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <form name="memberProfileModal" method="post">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title left"><i class="nav-icon fas fa-image"></i> Update Profile Image</h5>
                        <a href="#" class="modal-close right"><i class="mdl2 mdl2-cancel" aria-hidden="true"></i></a>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="img-container">
                                        <img id="imageMember" :src="imageData" alt="Picture">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="img-fluid">
                                        <div class="img-preview-member preview-lg">
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-9 docs-buttons">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="setDragMode" data-option="move"
                                                title="Move">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrows-alt"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="setDragMode" data-option="crop"
                                                title="Crop">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-crop"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="zoom" data-option="0.1"
                                                title="Zoom In">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-search-plus"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="zoom" data-option="-0.1"
                                                title="Zoom Out">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-search-minus"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="move" data-option="-10"
                                                data-second-option="0" title="Move Left">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrow-left"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="move" data-option="10"
                                                data-second-option="0" title="Move Right">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrow-right"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="move" data-option="0"
                                                data-second-option="-10" title="Move Up">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrow-up"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="move" data-option="0"
                                                data-second-option="10" title="Move Down">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrow-down"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="scaleX" data-option="-1"
                                                title="Flip Horizontal">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrows-alt-h"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="scaleY" data-option="-1"
                                                title="Flip Vertical">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-arrows-alt-v"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="disable" title="Disable">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-lock"></i>
                                            </span>
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="enable" title="Enable">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false">
                                                <i class="fas fa-lock-open"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="reset" title="Reset">
                                            <span class="docs-tooltip" data-toggle="tooltip" data-animation="false" title="$().cropper(&quot;reset&quot;)">
                                                <i class="fas fa-sync-alt"></i>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="justify-content-between">
                                <div class="upload-btn-wrapper">
                                    <button class="btn btn-primary">Upload image</button>
                                    <input type="file" name="file" id="inputImageMember" accept="image/*" />
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default btn-sm" v-on:click="DestroyCropperMember()" data-dismiss="modal"><i class="nav-icon fas fa-times-circle"></i> Close</button>
                        <button type="button" class="btn btn-success btn-sm" v-on:click="SetMemberImage()"><i class="nav-icon fas fa-check-circle"></i> Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div> 
<style>
    .modal-xl {
        /*min-width: 80% !important;*/
        max-width: 95%!important;
    } 
    .modal-xls {
        /*min-width: 80% !important;*/
        max-width: 70% !important;
    }
</style>

<script src="~/js/app/services/member.js?d=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
<script src="~/js/app/services/department.js?d=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
<script src="~/js/app/services/cell.js?d=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
<script src="~/js/app/services/ministry.js?d=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
<script src="~/js/app/services/position.js?d=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
<script src="~/js/app/controllers/member.js?d=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
<script src="~/lib/jquery-twbspagination/jquery.twbspagination.js"></script>